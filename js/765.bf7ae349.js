"use strict";(self["webpackChunksocial_networking_site"]=self["webpackChunksocial_networking_site"]||[]).push([[765],{1765:function(a,s,e){e.r(s),e.d(s,{default:function(){return E}});var t=e(3396),r=e(7139),o=e(9242);const i=a=>((0,t.dD)("data-v-4383c472"),a=a(),(0,t.Cn)(),a),l=i((()=>(0,t._)("div",{class:"post-article"},[(0,t._)("h2",{class:"mt-3"},"修改個人資料")],-1))),n={class:"row-button px-3 mt-4"},d={class:"card"},m={class:"card-user"},c={class:"card-user-icon-block mt-3 mx-auto"},p={class:"card-user-icon-img mx-auto"},u=["src"],f={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},h={class:"card-user-icon-label mt-3"},w=(0,t.Uk)(" 上傳大頭貼 "),g={key:0,class:"spinner-border spinner-border-sm",role:"status"},b={class:"mt-2"},D=i((()=>(0,t._)("label",{class:"card-post-label",for:"name"},"暱稱",-1))),_={key:0,class:"wrong-msg mt-1"},y={class:"mt-3"},k=i((()=>(0,t._)("label",{class:"card-user-label mb-1"},"性別",-1))),v=i((()=>(0,t._)("label",{class:"card-post-label me-3",for:"male"},"男性",-1))),x=i((()=>(0,t._)("label",{class:"card-post-label me-3",for:"female"},"女性",-1))),U=i((()=>(0,t._)("label",{class:"card-post-label me-3",for:"other"},"其他",-1))),P={class:"mt-3"},I=i((()=>(0,t._)("label",{class:"card-user-label mb-1"},"權限",-1))),L=i((()=>(0,t._)("label",{class:"card-post-label me-3",for:"GM"},"最高權限",-1))),V=["disabled"],$={class:"mt-2"},C=i((()=>(0,t._)("label",{class:"card-post-label",for:"name"},"輸入新密碼",-1))),M={key:0,class:"wrong-msg mt-1"},q={class:"mt-2"},G=i((()=>(0,t._)("label",{class:"card-post-label",for:"name"},"再次輸入新密碼",-1))),z={key:0,class:"wrong-msg mt-1"},S=["disabled"],T=(0,t.Uk)(" 更改密碼 "),H={key:0,class:"spinner-border spinner-border-sm",role:"status"};function R(a,s,e,i,R,Z){return(0,t.wg)(),(0,t.iD)("div",null,[l,(0,t._)("div",n,[(0,t._)("button",{class:(0,r.C_)(["name"===R.tabsState?"active":"","px-4 pt-2 pb-2"]),onClick:s[0]||(s[0]=a=>Z.changeTabs("name"))}," 暱稱修改 ",2),(0,t._)("button",{class:(0,r.C_)(["password"===R.tabsState?"active":"","px-4 pt-2 pb-2"]),onClick:s[1]||(s[1]=a=>Z.changeTabs("password"))}," 重設密碼 ",2)]),(0,t._)("div",d,[(0,t._)("div",m,["name"===R.tabsState?((0,t.wg)(),(0,t.iD)(t.HY,{key:0},[(0,t._)("div",c,[(0,t._)("div",p,[R.fromData.image?((0,t.wg)(),(0,t.iD)("img",{key:0,src:R.userUrl?R.userUrl:R.fromData.image,alt:""},null,8,u)):((0,t.wg)(),(0,t.iD)("img",f))]),(0,t._)("label",h,[w,R.isLoad?((0,t.wg)(),(0,t.iD)("div",g)):(0,t.kq)("",!0),R.isLoad?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("input",{key:1,ref:"fileInput",type:"file",onInput:s[2]||(s[2]=(...a)=>Z.fileReader&&Z.fileReader(...a))},null,544))])]),(0,t._)("div",b,[D,(0,t.wy)((0,t._)("input",{class:"card-post-input p-3 mt-1",id:"name","onUpdate:modelValue":s[3]||(s[3]=a=>R.fromData.name=a),type:"text",placeholder:"輸入暱稱",onInput:s[4]||(s[4]=a=>Z.formatVerify())},null,544),[[o.nr,R.fromData.name]]),R.state.name?((0,t.wg)(),(0,t.iD)("div",_,[(0,t._)("span",null,(0,r.zw)(R.errorMessage.name),1)])):(0,t.kq)("",!0)]),(0,t._)("div",y,[k,(0,t.wy)((0,t._)("input",{class:"me-2",id:"male",type:"radio",name:"sex",value:"male","onUpdate:modelValue":s[5]||(s[5]=a=>R.fromData.sex=a)},null,512),[[o.G2,R.fromData.sex]]),v,(0,t.wy)((0,t._)("input",{class:"me-2",id:"female",type:"radio",name:"sex",value:"female","onUpdate:modelValue":s[6]||(s[6]=a=>R.fromData.sex=a)},null,512),[[o.G2,R.fromData.sex]]),x,(0,t.wy)((0,t._)("input",{class:"me-2",id:"other",type:"radio",name:"sex",value:"other","onUpdate:modelValue":s[7]||(s[7]=a=>R.fromData.sex=a)},null,512),[[o.G2,R.fromData.sex]]),U]),(0,t._)("div",P,[I,(0,t.wy)((0,t._)("input",{class:"me-2",id:"GM",type:"radio",name:"auth",value:"1","onUpdate:modelValue":s[8]||(s[8]=a=>R.fromData.auth=a)},null,512),[[o.G2,R.fromData.auth]]),L]),(0,t._)("button",{disabled:R.isLoad,class:"card-post-button mt-4 mx-auto",onClick:s[9]||(s[9]=a=>Z.patchUserData())}," 更改暱稱 ",8,V)],64)):((0,t.wg)(),(0,t.iD)(t.HY,{key:1},[(0,t._)("div",$,[C,(0,t.wy)((0,t._)("input",{class:"card-post-input p-3 mt-1",id:"password","onUpdate:modelValue":s[10]||(s[10]=a=>R.fromData.password=a),type:"password",placeholder:"輸入密碼",onInput:s[11]||(s[11]=a=>Z.formatVerify(!0))},null,544),[[o.nr,R.fromData.password]]),R.state.password?((0,t.wg)(),(0,t.iD)("div",M,[(0,t._)("span",null,(0,r.zw)(R.errorMessage.password),1)])):(0,t.kq)("",!0)]),(0,t._)("div",q,[G,(0,t.wy)((0,t._)("input",{class:"card-post-input p-3 mt-1",id:"confirmPassword","onUpdate:modelValue":s[12]||(s[12]=a=>R.fromData.confirmPassword=a),type:"password",placeholder:"再次輸入新密碼",onInput:s[13]||(s[13]=a=>Z.formatVerify(!0)),onKeyup:s[14]||(s[14]=(0,o.D2)((a=>Z.changePassword()),["enter"]))},null,544),[[o.nr,R.fromData.confirmPassword]]),R.state.confirmPassword?((0,t.wg)(),(0,t.iD)("div",z,[(0,t._)("span",null,(0,r.zw)(R.errorMessage.confirmPassword),1)])):(0,t.kq)("",!0)]),(0,t._)("button",{disabled:R.isLoad,class:"card-post-button mt-4 mx-auto",onClick:s[15]||(s[15]=a=>Z.changePassword())},[T,R.isLoad?((0,t.wg)(),(0,t.iD)("div",H)):(0,t.kq)("",!0)],8,S)],64))])])])}var Z={data(){return{isLoad:!1,tabsState:"name",userUrl:null,fromData:{name:this.$store.state.userInfo.name,sex:this.$store.state.userInfo.sex,image:this.$store.state.userInfo.image,password:"",confirmPassword:"",auth:""},errorMessage:{name:null,passWord:null,confirmPassword:null,changeError:null},state:{name:null,sex:null,image:null,password:null,confirmPassword:null}}},methods:{changePassword(){if(!this.formatVerify())return;this.isLoad=!0;const a=this.fromData;console.log(this.fromData,"fromData"),this.axios.post("https://ciye-social-site-api.herokuapp.com/users/updatePassword",a).then((()=>{this.getUserData(),this.fromData={name:this.$store.state.userInfo.name,sex:this.$store.state.userInfo.sex,image:this.$store.state.userInfo.image,password:"",confirmPassword:"",auth:""},this.isLoad=!1,alert("修改成功")})).catch((a=>{this.isLoad=!1,alert("修改失敗")}))},patchUserData(){if(!this.formatVerify())return;this.isLoad=!0;const a=this.fromData;this.axios.patch("https://ciye-social-site-api.herokuapp.com/users/updateProfile",a).then((()=>{this.getUserData(),this.fromData.password="",this.fromData.confirmPassword="",this.isLoad=!1,alert("修改成功")})).catch((()=>{this.isLoad=!1,alert("修改失敗")}))},getUserData(){this.axios.get("https://ciye-social-site-api.herokuapp.com/users/profile").then((a=>{this.$store.commit("setUserInfo",a.data.data.user)})).catch((()=>{alert("token過期，請先登入")}))},changeTabs(a){this.tabsState=a},fileReader(){this.isLoad=!0,"image/jpeg"!==this.$refs.fileInput.files[0].type&&"image/png"!==this.$refs.fileInput.files[0].type&&alert("僅支援 jpg、png 檔，請重新上傳！");const a=new FormData;a.append("file-to-upload",this.$refs.fileInput.files[0]),this.axios.post("https://ciye-social-site-api.herokuapp.com/upload",a).then((a=>{console.log(a,"filterasd"),this.userUrl=a.data.imgUrl,this.fromData.image=a.data.imgUrl,this.isLoad=!1})).catch((()=>{alert("上傳失敗")}))},formatVerify(a){const s=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,e=[];for(const t in this.state)this.state[t]=!1;return this.fromData.name.length<2&&(this.state.name=!0,this.errorMessage.name="暱稱至少 2 個字元以上",e.push("name")),!s.test(this.fromData.password)&&a&&(this.errorMessage.password="密碼需至少 8 碼以上，並中英混合",this.state.password=!0,e.push("signUpError")),this.fromData.confirmPassword===this.fromData.password&&this.fromData.confirmPassword||!a||(this.errorMessage.confirmPassword="與密碼不同",this.state.confirmPassword=!0,e.push("confirmPassword")),0===e.length}},mounted(){}},j=e(89);const A=(0,j.Z)(Z,[["render",R],["__scopeId","data-v-4383c472"]]);var E=A}}]);
//# sourceMappingURL=765.bf7ae349.js.map