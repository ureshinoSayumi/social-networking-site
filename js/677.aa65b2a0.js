"use strict";(self["webpackChunksocial_networking_site"]=self["webpackChunksocial_networking_site"]||[]).push([[677],{8318:function(t,s,e){e.d(s,{Z:function(){return at}});var o=e(3396),a=e(7139),i=e(9242);const l=t=>((0,o.dD)("data-v-660bbe4e"),t=t(),(0,o.Cn)(),t),n={class:"lodingBlock mt-3"},r={key:0,class:"spinner-border mx-auto",style:{"font-size":"0.5rem"},role:"status"},c=l((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),d=[c],p={class:"card-user"},u={class:"card-user-icon"},m=["src"],h={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},g={class:"card-user-text ms-3"},k={class:"card-user-name"},w={class:"card-user-date"},f={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},_={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},y=["onClick"],v={class:"card-content mt-4"},D={class:"card-content-text"},b={class:"mt-3"},$=["src"],L={class:"card-good-block mt-3"},P={class:"card-good-icon"},x=["onClick"],C={key:0,class:"card-good-text ms-2 mt-2"},A={key:0,class:"card-good-text ms-2 mt-2"},q={key:1,class:"spinner-border spinner-border-sm mt-2 ms-auto",role:"status"},E={key:0,class:"card-user-input-black mt-3"},I={class:"card-user-input-img"},V=["src"],z={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},H={class:"card-user-input ms-2"},M=["onKeyup"],U=["onClick"],T={class:"card-message-block"},K=["src"],S={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},W={class:"card-user-text ms-2 mx-2 w-75"},Y={class:"card-user-name"},j={class:"card-user-date"},B={key:0,class:"card-user-name mt-1"},Z=["onUpdate:modelValue","onKeyup"],G={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},N={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},R=["onClick"],F=["onClick"],O={class:"lodingBlock mt-3"},J={key:0,class:"spinner-border mx-auto",style:{"font-size":"0.5rem"},role:"status"},Q=l((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),X=[Q];function tt(t,s,e,l,c,Q){const tt=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",n,[e.loading?((0,o.wg)(),(0,o.iD)("div",r,d)):(0,o.kq)("",!0)]),c.postBlock?(0,o.kq)("",!0):((0,o.wg)(!0),(0,o.iD)(o.HY,{key:0},(0,o.Ko)(e.postData,(e=>((0,o.wg)(),(0,o.iD)("div",{class:"card mt-3",key:e._id},[(0,o._)("div",p,[(0,o._)("div",u,[(0,o.Wm)(tt,{to:`/user/${e.user._id}`,href:"#"},{default:(0,o.w5)((()=>[e.user.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.user.image,alt:""},null,8,m)):((0,o.wg)(),(0,o.iD)("img",h))])),_:2},1032,["to"])]),(0,o._)("div",g,[(0,o.Wm)(tt,{to:`/user/${e.user._id}`,href:"#"},{default:(0,o.w5)((()=>[(0,o._)("p",k,(0,a.zw)(e.user.name),1)])),_:2},1032,["to"]),(0,o._)("p",w,(0,a.zw)(Q.formatDate(e.createdAt)),1)]),t.$store.state.userInfo._id===e.user._id||"1"===t.$store.state.userInfo.auth?((0,o.wg)(),(0,o.iD)("i",f)):(0,o.kq)("",!0),(0,o._)("ul",_,[(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:(0,i.iM)((t=>Q.deletePost(e)),["prevent"])},"刪除貼文",8,y)])])]),(0,o._)("div",v,[(0,o._)("div",D,(0,a.zw)(e.content),1),(0,o._)("div",b,[e.image?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"card-content-img",src:e.image,alt:""},null,8,$)):(0,o.kq)("",!0)])]),(0,o._)("div",L,[(0,o._)("div",P,[(0,o._)("i",{class:"bi bi-hand-thumbs-up icons-item",onClick:t=>Q.setLike(e)},null,8,x)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.likes,((t,s)=>((0,o.wg)(),(0,o.iD)(o.HY,{key:t.id},[s<2?((0,o.wg)(),(0,o.iD)("p",C,(0,a.zw)(t.name),1)):(0,o.kq)("",!0)],64)))),128)),e.likes.length>2?((0,o.wg)(),(0,o.iD)("p",A,"..."+(0,a.zw)(e.likes.length)+"人",1)):(0,o.kq)("",!0),c.propsLoading?((0,o.wg)(),(0,o.iD)("div",q)):(0,o.kq)("",!0)]),((0,o.wg)(),(0,o.iD)("div",E,[(0,o._)("div",I,[t.$store.state.userInfo.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:t.$store.state.userInfo.image,alt:""},null,8,V)):((0,o.wg)(),(0,o.iD)("img",z))]),(0,o._)("div",H,[(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>c.fromData.comment=t),type:"text",placeholder:"留言...",onKeyup:(0,i.D2)((t=>Q.postComment(e)),["enter"])},null,40,M),[[i.nr,c.fromData.comment]]),(0,o._)("button",{class:"card-user-input-button",onClick:t=>Q.postComment(e)},"留言",8,U)])])),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.comments,(s=>((0,o.wg)(),(0,o.iD)("div",{class:"card-message mt-3",key:s._id},[(0,o._)("div",T,[(0,o.Wm)(tt,{class:"card-user-input-img",to:`/user/${s.user._id}`,href:"#"},{default:(0,o.w5)((()=>[s.user.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:s.user.image,alt:""},null,8,K)):((0,o.wg)(),(0,o.iD)("img",S))])),_:2},1032,["to"]),(0,o._)("div",W,[(0,o.Wm)(tt,{to:`/user/${e.user._id}`,href:"#"},{default:(0,o.w5)((()=>[(0,o._)("p",Y,(0,a.zw)(s.user.name),1)])),_:2},1032,["to"]),(0,o._)("p",j,(0,a.zw)(Q.formatDate(s.createdAt)),1),s.isEdit?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("p",B,(0,a.zw)(s.comment),1)),s.isEdit?(0,o.wy)(((0,o.wg)(),(0,o.iD)("input",{key:1,class:"w-100","onUpdate:modelValue":t=>s.comment=t,type:"text",placeholder:"留言...",onKeyup:(0,i.D2)((t=>Q.updataComment(s)),["enter"])},null,40,Z)),[[i.nr,s.comment]]):(0,o.kq)("",!0)]),t.$store.state.userInfo._id===s.user._id||"1"===t.$store.state.userInfo.auth?((0,o.wg)(),(0,o.iD)("i",G)):(0,o.kq)("",!0),(0,o._)("ul",N,[(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:(0,i.iM)((t=>Q.deleteComment(s)),["prevent"])},"刪除留言",8,R)]),(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",onClick:(0,i.iM)((t=>Q.editComment(s)),["prevent"]),href:"#"},"編輯貼文",8,F)])])])])))),128))])))),128)),(0,o._)("div",O,[e.loading&&e.postData.length?((0,o.wg)(),(0,o.iD)("div",J,X)):(0,o.kq)("",!0)])])}var st={props:{postData:{type:Object,default(){return{}}},loading:{type:Boolean}},emits:["get-all-post"],data(){return{propsLoading:!1,postBlock:!1,fromData:{comment:null},isEdit:!1}},methods:{getAllpost(t,s){this.$emit("get-all-post",t,s)},postComment(t){this.propsLoading=!0;const s=this.fromData;this.axios.post(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}/comment`,s).then((()=>{this.getAllpost(),this.fromData.comment=null,this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("傳送失敗")}))},setLike(t){const s=t.likes.find((t=>t.name===this.$store.state.userInfo.name));s?this.clearLike(t):(this.propsLoading=!0,this.axios.post(`https://ciye-social-site-api.herokuapp.com/post/${t._id}/like`).then((()=>{this.getAllpost(),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("按讚失敗")})))},clearLike(t){this.propsLoading=!0,this.axios.delete(`https://ciye-social-site-api.herokuapp.com/post/${t._id}/unlike`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1,alert("收回成功")})).catch((()=>{this.propsLoading=!1,alert("收回失敗")}))},formatDate(t){const s=new Date(t),e=`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()} ${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`;return e},deletePost(t){this.propsLoading=!0,this.axios.delete(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1,alert("刪除成功")})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},deleteComment(t){this.propsLoading=!0,this.axios.delete(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}/comment`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1,alert("刪除成功")})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},updataComment(t){const s={comment:t.comment};this.isEdit=!0,this.axios.patch(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}/comment`,s).then((()=>{this.getAllpost(),this.isEdit=!1})).catch((()=>{this.isEdit=!1,alert("傳送失敗")}))},editComment(t){t.isEdit=!0}},mounted(){}},et=e(89);const ot=(0,et.Z)(st,[["render",tt],["__scopeId","data-v-660bbe4e"]]);var at=ot},8677:function(t,s,e){e.r(s),e.d(s,{default:function(){return T}});var o=e(3396),a=e(9242);const i=t=>((0,o.dD)("data-v-b710e23c"),t=t(),(0,o.Cn)(),t),l={key:0,class:"row-menu"},n={class:"col-select"},r=i((()=>(0,o._)("option",{class:"option",value:""},"最新貼文",-1))),c=i((()=>(0,o._)("option",{value:"asc"},"最舊貼文",-1))),d=[r,c],p={class:"col-serch-input"},u=i((()=>(0,o._)("i",{class:"bi bi-search",style:{"font-size":"1.7rem"}},null,-1))),m=[u],h={key:3,class:"card mt-3"},g=i((()=>(0,o._)("div",{class:"card-stand"},null,-1))),k=i((()=>(0,o._)("div",{class:"card-stand-block mx-auto"},[(0,o._)("p",{class:"card-stand-p mt-4 mb-2"},"目前尚無動態，新增一則貼文吧！")],-1))),w=[g,k];function f(t,s,e,i,r,c){const u=(0,o.up)("TrendWallView"),g=(0,o.up)("SendPostView");return(0,o.wg)(),(0,o.iD)("div",null,[t.$store.state.switch?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",l,[(0,o._)("div",n,[(0,o.wy)((0,o._)("select",{class:"select","onUpdate:modelValue":s[0]||(s[0]=t=>r.filter=t),onChange:s[1]||(s[1]=t=>c.getAllPost(r.filter,r.searchPost))},d,544),[[a.bM,r.filter]])]),(0,o._)("div",p,[(0,o.wy)((0,o._)("input",{class:"serch-input","onUpdate:modelValue":s[2]||(s[2]=t=>r.searchPost=t),type:"text",placeholder:"搜尋貼文"},null,512),[[a.nr,r.searchPost]]),(0,o._)("button",{class:"serch-button",onClick:s[3]||(s[3]=t=>c.getAllPost(r.filter,r.searchPost))},m)])])),t.$store.state.switch?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(u,{key:1,postData:r.allPost,loading:r.loading,onGetAllPost:c.getAllPost},null,8,["postData","loading","onGetAllPost"])),t.$store.state.switch?((0,o.wg)(),(0,o.j4)(g,{key:2,onGetAllPost:c.getAllPost},null,8,["onGetAllPost"])):(0,o.kq)("",!0),r.allPost.length?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",h,w))])}var _=e(8318);const y=t=>((0,o.dD)("data-v-3dfdb293"),t=t(),(0,o.Cn)(),t),v=y((()=>(0,o._)("div",{class:"post-article"},[(0,o._)("h2",{class:"mt-3"},"張貼動態")],-1))),D={class:"card mt-3"},b=y((()=>(0,o._)("label",{class:"card-post-label",for:"story"},"貼文內容:",-1))),$={class:"card-post-input mt-3"},L=(0,o.Uk)(" 上傳圖片 "),P={key:0,class:"spinner-border spinner-border-sm",role:"status"},x=["src"],C=["disabled"],A=(0,o.Uk)(" 送出貼文 "),q={key:0,class:"spinner-border spinner-border-sm",role:"status"};function E(t,s,e,i,l,n){return(0,o.wg)(),(0,o.iD)("div",null,[v,(0,o._)("div",D,[b,(0,o.wy)((0,o._)("textarea",{class:"card-post-text p-3 mt-1","onUpdate:modelValue":s[0]||(s[0]=t=>l.fromData.content=t),id:"story",name:"story",rows:"5",cols:"50"},"目前尚無動態，新增一則貼文吧！",512),[[a.nr,l.fromData.content]]),(0,o._)("label",$,[L,(0,o._)("input",{ref:"fileInput",type:"file",onInput:s[1]||(s[1]=(...t)=>n.fileReader&&n.fileReader(...t))},null,544),l.isLoad?((0,o.wg)(),(0,o.iD)("div",P)):(0,o.kq)("",!0)]),l.fromData.image?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"card-content-img mt-3",src:l.fromData.image,alt:""},null,8,x)):(0,o.kq)("",!0),(0,o._)("button",{disabled:l.isLoad,class:"card-post-button mt-4 mx-auto",onClick:s[2]||(s[2]=t=>n.postPost())},[A,l.isLoad?((0,o.wg)(),(0,o.iD)("div",q)):(0,o.kq)("",!0)],8,C)])])}var I={props:{},emits:["get-all-post"],data(){return{isLoad:!1,fromData:{content:null,image:null}}},methods:{getAllData(t,s){this.$emit("get-all-post",t,s)},postPost(){this.isLoad=!0;const t=this.fromData;console.log(this.fromData,"fromData"),this.axios.post("https://ciye-social-site-api.herokuapp.com/posts",t).then((t=>{console.log(t,"post"),this.isLoad=!1,this.fromData.content=null,this.fromData.image=null,this.getAllData(),alert("傳送成功"),this.$store.state.switch=!1})).catch((t=>{console.log(t,"post"),this.isLoad=!1,alert("傳送失敗")}))},fileReader(){this.isLoad=!0,"image/jpeg"!==this.$refs.fileInput.files[0].type&&"image/png"!==this.$refs.fileInput.files[0].type&&alert("僅支援 jpg、png 檔，請重新上傳！");const t=new FormData;t.append("file-to-upload",this.$refs.fileInput.files[0]),this.axios.post("https://ciye-social-site-api.herokuapp.com/upload",t).then((t=>{console.log(t,"filterasd"),this.fromData.image=t.data.imgUrl,this.isLoad=!1})).catch((t=>{console.log(t,"filter")}))}},mounted(){},watch:{}},V=e(89);const z=(0,V.Z)(I,[["render",E],["__scopeId","data-v-3dfdb293"]]);var H=z,M={components:{TrendWallView:_.Z,SendPostView:H},data(){return{name:"TenndView",searchPost:"",filter:"",allPost:[],loading:null,page:2,scrollEvent:null}},methods:{getAllPost(t="-createdAt",s="",e=1,o=!1){if(this.loading)return;this.loading=!0;const a={sort:`?timeSort=${t}`,search:`&q=${s}`,page:`&page=${e}`};this.axios.get(`https://ciye-social-site-api.herokuapp.com/posts${a.sort}${a.search}${a.page}`).then((t=>{if(o){t.data.data.length||window.removeEventListener("scroll",this.scrollEvent),this.page+=1;const s=this.allPost.concat(t.data.data);this.allPost=s}else this.allPost=t.data.data,this.page=2;this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getAllPost")}))},getPost(){this.loading=!0,this.axios.get(`https://ciye-social-site-api.herokuapp.com/posts/${this.$route.params.id}`).then((t=>{this.allPost=t.data.data,this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getAllPost")}))},buildThrottle(){function t(t,s){let e=0;return function(...o){const a=Date.now();a-e>s&&(e=a,t.apply(this,o))}}const s=t(this.getAllPost,1e3);this.scrollEvent=()=>{const t=window.scrollY+window.innerHeight>=document.body.offsetHeight-100;t&&s(this.filter,this.searchPost,this.page,!0)}},buildScrollEvent(){this.buildThrottle(),window.addEventListener("scroll",this.scrollEvent)}},mounted(){this.$route.params.id?this.getPost():this.getAllPost(),this.buildScrollEvent()},beforeUnmount(){window.removeEventListener("scroll",this.scrollEvent)}};const U=(0,V.Z)(M,[["render",f],["__scopeId","data-v-b710e23c"]]);var T=U}}]);
//# sourceMappingURL=677.aa65b2a0.js.map