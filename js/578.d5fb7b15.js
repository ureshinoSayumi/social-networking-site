"use strict";(self["webpackChunksocial_networking_site"]=self["webpackChunksocial_networking_site"]||[]).push([[578],{8318:function(t,e,s){s.d(e,{Z:function(){return it}});var o=s(3396),i=s(7139),a=s(9242);const l=t=>((0,o.dD)("data-v-660bbe4e"),t=t(),(0,o.Cn)(),t),n={class:"lodingBlock mt-3"},r={key:0,class:"spinner-border mx-auto",style:{"font-size":"0.5rem"},role:"status"},c=l((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),d=[c],p={class:"card-user"},u={class:"card-user-icon"},h=["src"],m={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},g={class:"card-user-text ms-3"},w={class:"card-user-name"},k={class:"card-user-date"},f={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},_={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},y=["onClick"],v={class:"card-content mt-4"},D={class:"card-content-text"},b={class:"mt-3"},$=["src"],L={class:"card-good-block mt-3"},P={class:"card-good-icon"},C=["onClick"],x={key:0,class:"card-good-text ms-2 mt-2"},E={key:0,class:"card-good-text ms-2 mt-2"},q={key:1,class:"spinner-border spinner-border-sm mt-2 ms-auto",role:"status"},z={key:0,class:"card-user-input-black mt-3"},U={class:"card-user-input-img"},A=["src"],I={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},H={class:"card-user-input ms-2"},M=["onKeyup"],V=["onClick"],K={class:"card-message-block"},T=["src"],W={key:1,src:"https://upload.cc/i1/2022/05/31/dVpHNT.png",alt:""},Y={class:"card-user-text ms-2 mx-2 w-75"},B={class:"card-user-name"},F={class:"card-user-date"},S={key:0,class:"card-user-name mt-1"},Z=["onUpdate:modelValue","onKeyup"],N={key:0,class:"bi bi-three-dots icons-item ms-auto",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"},j={class:"dropdown-menu dropstart","aria-labelledby":"dropdownMenuLink"},G=["onClick"],O=["onClick"],J={class:"lodingBlock mt-3"},Q={key:0,class:"spinner-border mx-auto",style:{"font-size":"0.5rem"},role:"status"},R=l((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),X=[R];function tt(t,e,s,l,c,R){const tt=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",n,[s.loading?((0,o.wg)(),(0,o.iD)("div",r,d)):(0,o.kq)("",!0)]),c.postBlock?(0,o.kq)("",!0):((0,o.wg)(!0),(0,o.iD)(o.HY,{key:0},(0,o.Ko)(s.postData,(s=>((0,o.wg)(),(0,o.iD)("div",{class:"card mt-3",key:s._id},[(0,o._)("div",p,[(0,o._)("div",u,[(0,o.Wm)(tt,{to:`/user/${s.user._id}`,href:"#"},{default:(0,o.w5)((()=>[s.user.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:s.user.image,alt:""},null,8,h)):((0,o.wg)(),(0,o.iD)("img",m))])),_:2},1032,["to"])]),(0,o._)("div",g,[(0,o.Wm)(tt,{to:`/user/${s.user._id}`,href:"#"},{default:(0,o.w5)((()=>[(0,o._)("p",w,(0,i.zw)(s.user.name),1)])),_:2},1032,["to"]),(0,o._)("p",k,(0,i.zw)(R.formatDate(s.createdAt)),1)]),t.$store.state.userInfo._id===s.user._id||"1"===t.$store.state.userInfo.auth?((0,o.wg)(),(0,o.iD)("i",f)):(0,o.kq)("",!0),(0,o._)("ul",_,[(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:(0,a.iM)((t=>R.deletePost(s)),["prevent"])},"刪除貼文",8,y)])])]),(0,o._)("div",v,[(0,o._)("div",D,(0,i.zw)(s.content),1),(0,o._)("div",b,[s.image?((0,o.wg)(),(0,o.iD)("img",{key:0,class:"card-content-img",src:s.image,alt:""},null,8,$)):(0,o.kq)("",!0)])]),(0,o._)("div",L,[(0,o._)("div",P,[(0,o._)("i",{class:"bi bi-hand-thumbs-up icons-item",onClick:t=>R.setLike(s)},null,8,C)]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.likes,((t,e)=>((0,o.wg)(),(0,o.iD)(o.HY,{key:t.id},[e<2?((0,o.wg)(),(0,o.iD)("p",x,(0,i.zw)(t.name),1)):(0,o.kq)("",!0)],64)))),128)),s.likes.length>2?((0,o.wg)(),(0,o.iD)("p",E,"..."+(0,i.zw)(s.likes.length)+"人",1)):(0,o.kq)("",!0),c.propsLoading?((0,o.wg)(),(0,o.iD)("div",q)):(0,o.kq)("",!0)]),((0,o.wg)(),(0,o.iD)("div",z,[(0,o._)("div",U,[t.$store.state.userInfo.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:t.$store.state.userInfo.image,alt:""},null,8,A)):((0,o.wg)(),(0,o.iD)("img",I))]),(0,o._)("div",H,[(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>c.fromData.comment=t),type:"text",placeholder:"留言...",onKeyup:(0,a.D2)((t=>R.postComment(s)),["enter"])},null,40,M),[[a.nr,c.fromData.comment]]),(0,o._)("button",{class:"card-user-input-button",onClick:t=>R.postComment(s)},"留言",8,V)])])),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(s.comments,(e=>((0,o.wg)(),(0,o.iD)("div",{class:"card-message mt-3",key:e._id},[(0,o._)("div",K,[(0,o.Wm)(tt,{class:"card-user-input-img",to:`/user/${e.user._id}`,href:"#"},{default:(0,o.w5)((()=>[e.user.image?((0,o.wg)(),(0,o.iD)("img",{key:0,src:e.user.image,alt:""},null,8,T)):((0,o.wg)(),(0,o.iD)("img",W))])),_:2},1032,["to"]),(0,o._)("div",Y,[(0,o.Wm)(tt,{to:`/user/${s.user._id}`,href:"#"},{default:(0,o.w5)((()=>[(0,o._)("p",B,(0,i.zw)(e.user.name),1)])),_:2},1032,["to"]),(0,o._)("p",F,(0,i.zw)(R.formatDate(e.createdAt)),1),e.isEdit?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("p",S,(0,i.zw)(e.comment),1)),e.isEdit?(0,o.wy)(((0,o.wg)(),(0,o.iD)("input",{key:1,class:"w-100","onUpdate:modelValue":t=>e.comment=t,type:"text",placeholder:"留言...",onKeyup:(0,a.D2)((t=>R.updataComment(e)),["enter"])},null,40,Z)),[[a.nr,e.comment]]):(0,o.kq)("",!0)]),t.$store.state.userInfo._id===e.user._id||"1"===t.$store.state.userInfo.auth?((0,o.wg)(),(0,o.iD)("i",N)):(0,o.kq)("",!0),(0,o._)("ul",j,[(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:(0,a.iM)((t=>R.deleteComment(e)),["prevent"])},"刪除留言",8,G)]),(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",onClick:(0,a.iM)((t=>R.editComment(e)),["prevent"]),href:"#"},"編輯貼文",8,O)])])])])))),128))])))),128)),(0,o._)("div",J,[s.loading&&s.postData.length?((0,o.wg)(),(0,o.iD)("div",Q,X)):(0,o.kq)("",!0)])])}var et={props:{postData:{type:Object,default(){return{}}},loading:{type:Boolean}},emits:["get-all-post"],data(){return{propsLoading:!1,postBlock:!1,fromData:{comment:null},isEdit:!1}},methods:{getAllpost(t,e){this.$emit("get-all-post",t,e)},postComment(t){this.propsLoading=!0;const e=this.fromData;this.axios.post(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}/comment`,e).then((()=>{this.getAllpost(),this.fromData.comment=null,this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("傳送失敗")}))},setLike(t){const e=t.likes.find((t=>t.name===this.$store.state.userInfo.name));e?this.clearLike(t):(this.propsLoading=!0,this.axios.post(`https://ciye-social-site-api.herokuapp.com/post/${t._id}/like`).then((()=>{this.getAllpost(),this.propsLoading=!1})).catch((()=>{this.propsLoading=!1,alert("按讚失敗")})))},clearLike(t){this.propsLoading=!0,this.axios.delete(`https://ciye-social-site-api.herokuapp.com/post/${t._id}/unlike`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1,alert("收回成功")})).catch((()=>{this.propsLoading=!1,alert("收回失敗")}))},formatDate(t){const e=new Date(t),s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`;return s},deletePost(t){this.propsLoading=!0,this.axios.delete(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1,alert("刪除成功")})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},deleteComment(t){this.propsLoading=!0,this.axios.delete(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}/comment`).then((()=>{this.getAllpost(this.filter,this.searchPost),this.propsLoading=!1,alert("刪除成功")})).catch((()=>{this.propsLoading=!1,alert("刪除失敗")}))},updataComment(t){const e={comment:t.comment};this.isEdit=!0,this.axios.patch(`https://ciye-social-site-api.herokuapp.com/posts/${t._id}/comment`,e).then((()=>{this.getAllpost(),this.isEdit=!1})).catch((()=>{this.isEdit=!1,alert("傳送失敗")}))},editComment(t){t.isEdit=!0}},mounted(){}},st=s(89);const ot=(0,st.Z)(et,[["render",tt],["__scopeId","data-v-660bbe4e"]]);var it=ot},6578:function(t,e,s){s.r(e),s.d(e,{default:function(){return L}});var o=s(3396),i=s(7139),a=s(9242);const l=t=>((0,o.dD)("data-v-77106240"),t=t(),(0,o.Cn)(),t),n={key:0,class:"follow-block"},r=["src"],c={class:"follow-block-data ms-2 me-4"},d={class:"mt-1"},p={key:0,class:"ms-auto"},u={key:1,class:"row-menu mt-3"},h={class:"col-select"},m=l((()=>(0,o._)("option",{value:""},"最新貼文",-1))),g=l((()=>(0,o._)("option",{value:"asc"},"最舊貼文",-1))),w=[m,g],k={class:"col-serch-input"},f=l((()=>(0,o._)("i",{class:"bi bi-search",style:{"font-size":"1.7rem"}},null,-1))),_=[f];function y(t,e,s,l,m,g){const f=(0,o.up)("TrendWallView");return(0,o.wg)(),(0,o.iD)("div",null,[m.user?((0,o.wg)(),(0,o.iD)("div",n,[(0,o._)("img",{src:m.user.image,alt:""},null,8,r),(0,o._)("div",c,[(0,o._)("h6",null,(0,i.zw)(m.user.name),1),(0,o._)("p",d,(0,i.zw)(m.user.followers.length)+"人追蹤",1)]),m.user._id!==t.$store.state.userInfo._id?((0,o.wg)(),(0,o.iD)("div",p,[-1===m.isFollow?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:e[0]||(e[0]=(...t)=>g.follow&&g.follow(...t)),class:"follow-button mt-3 me-3"}," 追蹤 ")):((0,o.wg)(),(0,o.iD)("button",{key:1,onClick:e[1]||(e[1]=(...t)=>g.unfollow&&g.unfollow(...t)),class:"follow-unfollow mt-3 me-3"}," 取消追蹤 "))])):(0,o.kq)("",!0)])):(0,o.kq)("",!0),t.$store.state.switch?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",u,[(0,o._)("div",h,[(0,o.wy)((0,o._)("select",{class:"select","onUpdate:modelValue":e[2]||(e[2]=t=>m.filter=t),onChange:e[3]||(e[3]=t=>g.getPost(m.filter,m.searchPost))},w,544),[[a.bM,m.filter]])]),(0,o._)("div",k,[(0,o.wy)((0,o._)("input",{class:"serch-input","onUpdate:modelValue":e[4]||(e[4]=t=>m.searchPost=t),type:"text",placeholder:"搜尋貼文"},null,512),[[a.nr,m.searchPost]]),(0,o._)("button",{class:"serch-button",onClick:e[5]||(e[5]=t=>g.getPost(m.filter,m.searchPost))},_)])])),t.$store.state.switch?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(f,{key:2,postData:m.allPost,loading:m.loading,onGetAllPost:g.getPost},null,8,["postData","loading","onGetAllPost"]))])}var v=s(8318),D={components:{TrendWallView:v.Z},data(){return{searchPost:"",filter:"",allPost:[],loading:null,user:null,isFollow:!1,page:2,scrollEvent:null}},methods:{getPost(t="-createdAt",e="",s=1,o=!1){if(this.loading)return;this.loading=!0;const i={sort:`?timeSort=${t}`,search:`&q=${e}`,page:`&page=${s}`};this.axios.get(`https://ciye-social-site-api.herokuapp.com/post/user/${this.$route.params.id}${i.sort}${i.search}${i.page}`).then((t=>{if(o){t.data.data.length||window.removeEventListener("scroll",this.scrollEvent),this.page+=1;const e=this.allPost.concat(t.data.data);this.allPost=e}else this.allPost=t.data.data,this.page=2;this.loading=!1})).catch((t=>{this.loading=!1,console.log(t,"getPost")}))},getUser(){this.axios.get(`https://ciye-social-site-api.herokuapp.com/users/${this.$route.params.id}`).then((t=>{this.user=t.data.data,this.isFollow=this.user.followers.findIndex((t=>t.user._id===this.$store.state.userInfo._id)),console.log(t,"getUser")})).catch((t=>{console.log(t,"getUser")}))},follow(){this.axios.post(`https://ciye-social-site-api.herokuapp.com/users/${this.$route.params.id}/follow`).then((t=>{this.getPost(),this.getUser(),console.log(t,"follow")})).catch((t=>{console.log(t.response.data.message,"follow"),alert(t.response.data.message)}))},unfollow(){this.axios.delete(`https://ciye-social-site-api.herokuapp.com/users/${this.$route.params.id}/unfollow`).then((t=>{this.getPost(),this.getUser(),console.log(t,"unfollow")})).catch((t=>{console.log(t,"unfollow")}))},buildThrottle(){function t(t,e){let s=0;return function(...o){const i=Date.now();i-s>e&&(s=i,t.apply(this,o))}}const e=t(this.getPost,1e3);this.scrollEvent=()=>{const t=window.scrollY+window.innerHeight>=document.body.offsetHeight-100;t&&e(this.filter,this.searchPost,this.page,!0)}},buildScrollEvent(){this.buildThrottle(),window.addEventListener("scroll",this.scrollEvent)}},mounted(){this.getPost(),this.getUser(),this.buildScrollEvent()},beforeUnmount(){window.removeEventListener("scroll",this.scrollEvent)},watch:{$route(){"single-user"===this.$route.name&&(this.getPost(),this.getUser())}}},b=s(89);const $=(0,b.Z)(D,[["render",y],["__scopeId","data-v-77106240"]]);var L=$}}]);
//# sourceMappingURL=578.d5fb7b15.js.map